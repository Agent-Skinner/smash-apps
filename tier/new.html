<!doctype html>
<html>
<head>
	  <link rel="icon" type="image/x-icon" href= "../icon.png"/>
	<title>Tier List Maker - Smash Apps</title>
	<link href="https://fonts.googleapis.com/css?family=Roboto:400,100italic" rel="stylesheet" type="text/css">
    <link href="newstyle.css" rel="stylesheet">
	<link href="dragula.min.css" rel="stylesheet">
</head>
<body>
	<div id="controls">
		<h1>TIER LIST MAKER - SMASH 4</h1>
		<div id="buttons">
			<button id="screenshot">Toggle screenshot mode</button>
			<button id="reset">Reset to default</button>
			<button id="help">Help</button>
		</div>
	</div>
	
	<div id="tablewrap"><table>
		<tr>
			<td class="labelHolder" contenteditable="true"><span class="label">S</span></td>
			<td><div class="tier sort" id="rows"></div></td>
			<td><div id="settings"></div></td>
		</tr>
		<tr>
			<td class="labelHolder" contenteditable="true"><span class="label">A</span></td>
			<td><div class="tier sort" id="rows"></div></td>
			<td><div id="settings"></div></td>
		</tr>
		<tr>
			<td class="labelHolder" contenteditable="true"><span class="label">B</span></td>
			<td><div class="tier sort" id="rows"></div></td>
			<td><div id="settings"></div></td>
		</tr>
		<tr>
			<td class="labelHolder" contenteditable="true"><span class="label">C</span></td>
			<td><div class="tier sort" id="rows"></div></td>
			<td><div id="settings"></div></td>
		</tr>
		<tr>
			<td class="labelHolder" contenteditable="true"><span class="label">D</span></td>
			<td><div class="tier sort" id="rows"></div></td>
			<td><div id="settings"></div></td>
		</tr>
		<tr>
			<td class="labelHolder" contenteditable="true"><span class="label">E</span></td>
			<td><div class="tier sort" id="rows"></div></td>
			<td><div id="settings"></div></td>
		</tr>
		<tr>
			<td class="labelHolder" contenteditable="true"><span class="label">F</span></td>
			<td><div class="tier sort" id="rows"></div></td>
			<td><div id="settings"></div></td>
		</tr>
	</table>
	</div>
	
	<div id="char4" class="sort">
		<div></div><div class="character" style="background:url('new/mario.png') center/64px;"></div><div class="character" style="background:url('new/luigi.png') center/64px;"></div><div class="character" style="background:url('new/peach.png') center/64px;"></div><div class="character" style="background:url('new/bowser.png') center/64px;"></div><div class="character" style="background:url('new/yoshi.png') center/64px;"></div><div class="character" style="background:url('new/rosalinaluma.png') center/64px;"></div><div class="character" style="background:url('new/bowserjr.png') center/64px;"></div><div class="character" style="background:url('new/wario.png') center/64px;"></div><div class="character" style="background:url('new/donkeykong.png') center/64px;"></div><div class="character" style="background:url('new/diddykong.png') center/64px;"></div><div class="character" style="background:url('new/mrgamewatch.png') center/64px;"></div><div class="character" style="background:url('new/littlemac.png') center/64px;"></div><div class="character" style="background:url('new/link.png') center/64px;"></div><div class="character" style="background:url('new/zelda.png') center/64px;"></div><div class="character" style="background:url('new/sheik.png') center/64px;"></div><div class="character" style="background:url('new/ganondorf.png') center/64px;"></div><div class="character" style="background:url('new/toonlink.png') center/64px;"></div><div class="character" style="background:url('new/samus.png') center/64px;"></div><div class="character" style="background:url('new/zerosuitsamus.png') center/64px;"></div><div class="character" style="background:url('new/pit.png') center/64px;"></div><div class="character" style="background:url('new/palutena.png') center/64px;"></div><div class="character" style="background:url('new/marth.png') center/64px;"></div><div class="character" style="background:url('new/ike.png') center/64px;"></div><div class="character" style="background:url('new/robin.png') center/64px;"></div><div class="character" style="background:url('new/duckhunt.png') center/64px;"></div><div class="character" style="background:url('new/kirby.png') center/64px;"></div><div class="character" style="background:url('new/kingdedede.png') center/64px;"></div><div class="character" style="background:url('new/metaknight.png') center/64px;"></div><div class="character" style="background:url('new/fox.png') center/64px;"></div><div class="character" style="background:url('new/falco.png') center/64px;"></div><div class="character" style="background:url('new/pikachu.png') center/64px;"></div><div class="character" style="background:url('new/charizard.png') center/64px;"></div><div class="character" style="background:url('new/lucario.png') center/64px;"></div><div class="character" style="background:url('new/jigglypuff.png') center/64px;"></div><div class="character" style="background:url('new/greninja.png') center/64px;"></div><div class="character" style="background:url('new/rob.png') center/64px;"></div><div class="character" style="background:url('new/ness.png') center/64px;"></div><div class="character" style="background:url('new/captainfalcon.png') center/64px;"></div><div class="character" style="background:url('new/villager.png') center/64px;"></div><div class="character" style="background:url('new/olimar.png') center/64px;"></div><div class="character" style="background:url('new/wiifittrainer.png') center/64px;"></div><div class="character" style="background:url('new/shulk.png') center/64px;"></div><div class="character" style="background:url('new/drmario.png') center/64px;"></div><div class="character" style="background:url('new/darkpit.png') center/64px;"></div><div class="character" style="background:url('new/lucina.png') center/64px;"></div><div class="character" style="background:url('new/pacman.png') center/64px;"></div><div class="character" style="background:url('new/megaman.png') center/64px;"></div><div class="character" style="background:url('new/sonic.png') center/64px;"></div><div class="character" style="background:url('new/mewtwo.png') center/64px;"></div><div class="character" style="background:url('new/lucas.png') center/64px;"></div><div class="character" style="background:url('new/roy.png') center/64px;"></div><div class="character" style="background:url('new/ryu.png') center/64px;"></div><div class="character" style="background:url('new/cloud.png') center/64px;"></div><div class="character" style="background:url('new/corrin.png') center/64px;"></div><div class="character" style="background:url('new/bayonetta.png') center/64px;"></div><div class="character" style="background:url('new/miibrawler.png') center/64px;"></div><div class="character" style="background:url('new/miigunner.png') center/64px;"></div><div class="character" style="background:url('new/miisword.png') center/64px;"></div>
	</div>
	
	<div id="overlay">
		<div id="modal">
			<h1>SETTINGS</h1>
			<p>Choose label color:</p>
			<div id="colorselect"><span style="background:#FF7F7F"></span><span style="background:#FFBF7F"></span><span style="background:#FFDF7F"></span><span style="background:#FFFF7F"></span><span style="background:#BFFF7F"></span><span style="background:#7FFF7F"></span><span style="background:#7FFFFF"></span><span style="background:#7FBFFF"></span><span style="background:#7F7FFF"></span><span style="background:#FF7FFF"></span><span style="background:#BF7FBF"></span><span style="background:#3B3B3A"></span><span style="background:#858585"></span><span style="background:#CFCECF"></span><span style="background:#F7F7F7"></span></div>
			<p>Row functions:</p>
			<p><button id="deleteRow">Delete row</button> <button id="clearRow">Clear row</button></p>
			<p><button id="addRowUp">Add row above</button> <button id="clearRow">Add row below</button></p>
		</div>
	</div>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
	<script src="dragula.min.js"></script>
	<script>
		dragula({
			isContainer: function (el) {
				return el.classList.contains('sort');
			}
		});
		
		var screenshotMode = false;
		var colors = ["#FF7F7F","#FFBF7F","#FFDF7F","#FFFF7F","#BFFF7F","#7FFF7F","#7FFFFF","#7FBFFF","#7F7FFF","#FF7FFF","#BF7FBF","#3B3B3A","#858585","#CFCECF","#F7F7F7"];
		// first is the row in the table of the tier, second is the index of its color
		var tierDefaults = [ [$("tr:nth-of-type(1)"), 0],
					  [$("tr:nth-of-type(2)"), 1],
					  [$("tr:nth-of-type(3)"), 3],
					  [$("tr:nth-of-type(4)"), 5],
					  [$("tr:nth-of-type(5)"), 7],
					  [$("tr:nth-of-type(6)"), 8],
					  [$("tr:nth-of-type(7)"), 9] ];
		var tier = []; // format: [element, color id]
		var tierlist = [];
		var currentTier; // i mean come on!
		var tempTier;
		var tierIndex;
		var currentColor;
		var colorIndex;
					  
		for (var i = 0; i < tierDefaults.length; i++) {
			tierDefaults[i][0].find(".labelHolder").css("background",colors[tierDefaults[i][1]]);
		}
			
		$(document).on("click touchend", "#settings", function() { // open settings modal
			currentTier = $(this).parent().parent();
			currentColor = currentTier.find(".labelHolder").css("background-color");
			colorIndex = colors.indexOf(rgb2hex(currentColor).toUpperCase());
			tier = [currentTier, colorIndex];
			console.log(tier);
			for (var i = 0; i < $("#modal span").length; i++) {
				$("#modal span:nth-of-type("+(i+1)+")").attr("class","nope");
			}
			$("#modal span:nth-of-type("+(colorIndex+1)+")").attr("class","selected");
			$("#overlay").css("opacity", 1);
			$("#overlay").css("visibility", "visible");
		});
		
		$(document).on("click touchend", "#colorselect span", function() { // change row label
			for (var i = 0; i < $("#modal span").length; i++) {
				$("#modal span:nth-of-type("+(i+1)+")").attr("class","nope");
			}
			$(this).attr("class","selected");
			currentTier.find(".labelHolder").css("background-color",$(this).css("background-color"));
			updateTiers();
		});
			
		$(document).on("click touchend", function(e) {
			clicked = e.target.id;
			if(clicked == "overlay") { // close settings modal
				$("#overlay").css("opacity", 0);
				$("#overlay").css("visibility", "hidden");
			} else if(clicked == "screenshot") { // toggle screenshot mode on or off
				if (screenshotMode) {
					$("td:last-of-type").css("display","table-cell");
					screenshotMode = false;
				} else {
					$("td:last-of-type").css("display","none");
					screenshotMode = true;
				}
			} else if(clicked == "clearRow") {
				for(var i = 0; i < currentTier.find("#rows div").length; i++) {
					$("#char4 div:last-child").after(currentTier.find("#rows div"));
				}
			} else if(clicked == "deleteRow") {
				for(var i = 0; i < currentTier.find("#rows div").length; i++) {
					$("#char4 div:last-child").after(currentTier.find("#rows div"));
				}
				currentTier.remove();
				updateTiers();
				$("#overlay").css("opacity", 0);
				$("#overlay").css("visibility", "hidden");
			} else if (clicked == "addRowUp") {
				$("tr:nth-of-type("+($("tr").index(currentTier)+1)+")").before("<tr><td class='labelHolder' contenteditable='true' style='background-color:#FFFF7F'><span class='label'>NEW</span></td><td><div class='tier sort' id='rows'></div></td><td><div id='settings'></div></td></tr>");
				updateTiers();
			} else if (clicked == "reset") {
				location.reload();
			}
		});
		
		// http://stackoverflow.com/a/3971432 thanks Zack Katz :D
		function rgb2hex(rgb) {
			rgb = rgb.match(/^rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*(\d+))?\)$/);
			function hex(x) {
				return ("0" + parseInt(x).toString(16)).slice(-2);
			}
			return "#" + hex(rgb[1]) + hex(rgb[2]) + hex(rgb[3]);
		}
		
		function updateTiers() {
			tierlist = [];
			tempTier = currentTier;
			for (var i = 0; i < $("tr").length; i++) {
				currentTier = $("tr:nth-of-type("+(i+1)+")");
				currentColor = currentTier.find(".labelHolder").css("background-color"); // returns in rgb format, have to convert to hex
				tier[0] = currentTier;
				tier[1] = colors.indexOf(rgb2hex(currentColor).toUpperCase());
				console.log(tier);
				tierlist.push(tier);
			}
			currentTier = tempTier;
			console.log(tierlist);
		}
		
		$(document).ready( function() {
			updateTiers();
		});
	</script>
</body>
